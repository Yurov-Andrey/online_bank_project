# online_bank_project

***Всем привет! Меня зовут Юров Андрей. Я учусь в online школе [sky.pro](https://sky.pro/#giftpopup) на phyton
разработчика. Данный проект является выполнением домашнего задания на втором курсе.***


Контекст проекта следующий:

*IT-отдел крупного банка делает новые фичи для личного кабинета клиента. Вам доверили реализовать этот проект, который
на бэкенде будет готовить данные для отображения в новом виджете.*
*Вы будете работать над проектом на протяжении всех домашних заданий этого курса.*

---

## Установка

1. [Клонирование репозитория](https://github.com/Yurov-Andrey/online_bank_project.git)
2. Все зависимости описаны в файле **peproject.toml**, все исключения добавлены в **.gitignore** установку необходимо
   начать с:

```
poetry install
```

---

## Использование

**Пакет src содержит следующие модули:**

- [masks.py](src/masks.py)
- [widget.py](src/widget.py)
- [processing.py](src/processing.py)
- [utils.py](src/utils.py)
- [generators.py](src/generators.py)
- [decorators.py](src/decorators.py)
- [external_api.py](src/external_api.py)
- [transactions_processing.py](src/transactions_processing.py)

---

**Содержание модулей и примеры работы функций**

1. **masks.py:**

- `def get_mask_card_number()` - *Функция маскирует номера принимаемых карт*

  *Пример работы функции:*

  ```7000792289606361     # входной аргумент```

  ```7000 79** **** 6361  # выход функции```


- `def get_mask_account()` - *Функция маскирует номера принимаемых счетов*

  *Пример работы функции:*

  ```73654108430135874305  # входной аргумент```

  ```**4305  # выход функции```

2. **widget.py**

- `def mask_account_card()` - *Функция принимает номер карты или счета и маскирует его, в зависимости от принятых
  данных*

  *Пример работы функции:*

  `# Пример для карты`

  `Visa Platinum 7000792289606361  # входной аргумент`

  `Visa Platinum 7000 79** **** 6361  # выход функции`

  `# Пример для счета`

  `Счет 73654108430135874305  # входной аргумент`

  `Счет **4305  # выход функции`


- `def get_date()` - *Функция принимает строковые данные содержащие текущую дату и выводит в удобном формате*

  *Пример работы функции:*

  `"2024-03-11T02:26:18.671407" # входной аргумент`

  `"11.03.2024" # выход функции`

3. **processing.py**

- `def filter_by_state()` - *Функция возвращает новый список словарей, содержащий только те словари, у которых ключ
  state соответствует указанному значению*

  *Пример работы функции:*

  `# Выход функции со статусом по умолчанию 'EXECUTED'`

  `[{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}, {'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}]`

  `# Выход функции, если вторым аргументов передано 'CANCELED'`

  `[{'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, {'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}]`

  `# пример входных данных`

  `[{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}, {'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}, {'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, {'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}]`


- `def sort_by_date()` - *Функция должна возвращать новый список, отсортированный по дате (date)*

  `# Выход функции (сортировка по убыванию, т. е. сначала самые последние операции)`

  `[{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}, {'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}, {'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, {'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}]`

  `# Пример входных данных`

  `[{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}, {'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}, {'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, {'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}]`


- `def sort_by_search_string()` - *Функция, которая принимает список словарей с данными о банковских операциях и строку поиска,
    а возвращает список словарей, у которых в описании есть данная строка.*

#### Пример результата работы функции:
```
[
        {'id': '3598919', 'state': 'EXECUTED', 'date': '2020-12-06T23:00:58Z',
         'amount': '29740', 'currency_name': 'Peso', 'currency_code': 'COP',
         'from': 'Discover 3172601889670065', 'to': 'Discover 0720428384694643',
         'description': 'Перевод с карты на карту'},
        {'id': '593027', 'state': 'CANCELED',
         'date': '2023-07-22T05:02:01Z',
         'amount': '30368',
         'currency_name': 'Shilling',
         'currency_code': 'TZS',
         'from': 'Visa 1959232722494097',
         'to': 'Visa 6804119550473710',
         'description': 'Перевод с карты на карту'}
    ]
```

- `def sort_by_category()` - *Функция, которая будет принимать список словарей с данными о банковских операциях и список категорий операций,
    а возвращать словарь, в котором ключи — это названия категорий,
    а значения — это количество операций в каждой категории.*

#### Пример результата работы функции:
```
{'Перевод организации': 1, 'Перевод с карты на карту': 2, 'Открытие вклада': 1}
```

4. **generators.py**

- def filter_by_currency() - *Функция, которая принимает на вход список словарей, представляющих транзакции.
  Функция должна возвращать итератор, который поочередно выдает транзакции,
  где валюта операции соответствует заданной (например, USD).*

  `# Пример входных данных`

   ```[{
            "id": 142264268,
            "state": "EXECUTED",
            "date": "2019-04-04T23:20:05.206878",
            "operationAmount": {
                "amount": "79114.93",
                "currency": {
                    "name": "USD",
                    "code": "USD"
                }
            },
            "description": "Перевод со счета на счет",
            "from": "Счет 19708645243227258542",
            "to": "Счет 75651667383060284188"
        },
        {
            "id": 873106923,
            "state": "EXECUTED",
            "date": "2019-03-23T01:09:46.296404",
            "operationAmount": {
                "amount": "43318.34",
                "currency": {
                    "name": "руб.",
                    "code": "RUB"
                }
            },
            "description": "Перевод со счета на счет",
            "from": "Счет 44812258784861134719",
            "to": "Счет 74489636417521191160"
        },]
- def transaction_descriptions() - *Функция принимает список словарей с транзакциями и возвращает описание каждой
  операции по очереди*

  `# Пример входных данных аналогичен как и для фкнции filter_by_currency()`

  `# Пример вывода`

    ```Перевод организации
    Перевод со счета на счет
    Перевод со счета на счет
    Перевод с карты на карту
    Перевод организации

- def card_number_generator() - *Функция генерирует номера карт в заданном диапазоне и выдаёт в корректном формате*

  `# Пример вывода`

    ```4276 4827 7896 2106
    4276 4827 7896 2107
    4276 4827 7896 2108
    4276 4827 7896 2109

5. **decorators.py:**

- `def log()` - *Декоратор, который автоматически логирует начало и конец выполнения функции,
  а также ее результаты или возникшие ошибки. Декоратор может логировать работу функции и ее результат как в файл,
  так и в консоль*

 #####  Пример вывода

   ```"my_function_for_test ok"```

  ```"Time to complete the function:"```

  ```"my_function_for_test error: unsupported operand type(s) for +: 'int' and 'str'. Inputs: (1, '2'), {}"```

6. **external_api.py:**

- `currency_conversion()` *Функция, которая принимает на вход транзакцию и возвращает сумму транзакции (amount) в
  рублях, тип данных —
  float. Если транзакция была в USD или EUR, происходит обращение к внешнему API для получения текущего курса валют
  и конвертации суммы операции в рубли.*

#### Пример полученных данных о конвертации валюты:

   ```{
        "date": "2024-12-05",
        "info": {
            "rate": 105.00057,
            "timestamp": 1733380935
        },
        "query": {
            "amount": 8221.37,
            "from": "USD",
            "to": "RUB"
        },
        "result": 863248.536181,
        "success": True
     }```

```
Пример вывода результата функции:
 `8221.37`
 
7. **utils.py:**

- `processing_json_dict()` *Функция, которая принимает на вход путь до JSON-файла и возвращает список словарей с данными о финансовых транзакциях.
    Если файл пустой, содержит не список или не найден, функция возвращает пустой список.*

Пример вывода результата функции:
```
[
  {
    "id": 441945886,
    "state": "EXECUTED",
    "date": "2019-08-26T10:50:58.294041",
    "operationAmount": {
      "amount": "31957.58",
      "currency": {
        "name": "руб.",
        "code": "RUB"
      }
    },
    "description": "Перевод организации",
    "from": "Maestro 1596837868705199",
    "to": "Счет 64686473678894779589"
  },
  {
    "id": 41428829,
    "state": "EXECUTED",
    "date": "2019-07-03T18:35:29.512364",
    "operationAmount": {
      "amount": "8221.37",
      "currency": {
        "name": "USD",
        "code": "USD"
      }
    },
    "description": "Перевод организации",
    "from": "MasterCard 7158300734726758",
    "to": "Счет 35383033474447895560"
  }]
```

7. **transactions_processing.py:**

- `processing_csv` - Функция для считывания финансовых операций из CSV. Принимает путь к файлу CSV в качестве аргумента и
    считывает финансовые операции из CSV, после чего выдает список словарей с транзакциями.


- `processing_excel` - Функция для считывания финансовых операций из xlsx. Принимает путь к файлу xlsx в качестве аргумента и
    считывает финансовые операции из xlsx, после чего выдает список словарей с транзакциями.

Пример вывода результата работы функций:
```[
        {'id': '650703', 'state': 'EXECUTED', 'date': '2023-09-05T11:30:32Z', 'amount': '16210', 'currency_name': 'Sol',
         'currency_code': 'PEN', 'from': 'Счет 58803664561298323391', 'to': 'Счет 39745660563456619397',
         'description': 'Перевод организации'},
        {'id': '3598919', 'state': 'EXECUTED', 'date': '2020-12-06T23:00:58Z',
         'amount': '29740', 'currency_name': 'Peso', 'currency_code': 'COP',
         'from': 'Discover 3172601889670065', 'to': 'Discover 0720428384694643',
         'description': 'Перевод с карты на карту'},
        {'id': '593027', 'state': 'CANCELED',
         'date': '2023-07-22T05:02:01Z',
         'amount': '30368',
         'currency_name': 'Shilling',
         'currency_code': 'TZS',
         'from': 'Visa 1959232722494097',
         'to': 'Visa 6804119550473710',
         'description': 'Перевод с карты на карту'},
        {'id': '5380041',
         'state': 'CANCELED',
         'date': '2021-02-01T11:54:58Z',
         'amount': '23789',
         'currency_name': 'Peso',
         'currency_code': 'UYU',
         'from': '',
         'to': 'Счет 23294994494356835683',
         'description': 'Открытие вклада'}
    ]
```

---


# main.py
#### Основная функция проекта отвечает за обработку пользовательского запроса. Пользователь выбирает между 3 предложенными вариантами обработки данных, а также возможной фильтрации данных. На основе пользовательского решения , программа выдает различные данные о транзакциях.

Пример работы функции

```
30.08.2021 Перевод с карты на карту Mastercard 3924 59** **** 5344 -> Visa 4023 20** **** 9133 Сумма: 18687 EUR
07.09.2020 Перевод с карты на карту Discover 2547 09** **** 3746 -> Discover 1506 53** **** 7020 Сумма: 17368 PLN
13.08.2022 Перевод с карты на карту Visa 2860 18** **** 3465 -> Discover 4880 89** **** 6329 Сумма: 14650 TND
28.11.2020 Перевод с карты на карту Visa 3233 29** **** 8307 -> Visa 9919 34** **** 8547 Сумма: 33427 EUR
26.09.2021 Открытие вклада Отсутствует номер счета или карты -> Счет **49269 Сумма: 15109 CNY
08.07.2023 Перевод с карты на карту Discover 8086 80** **** 5997 -> Visa 0250 61** **** 9995 Сумма: 23949 PHP
```

---

## Тестирование:

Для запуска тестов используйте команду:

```
pytest
```

Введите команду:

```
pytest --cov=src --cov-report=html
```

Чтобы сгенерировать отчет о покрытии в HTML-формате, где
src — пакет c модулями, которые тестируем.
Отчет будет сгенерирован в папке htmlcov и храниться в файле
с названием index.html:


---

## Документация:

Для получения дополнительной информации обратитесь к [документации](//README.md).

---

## Лицензия:

Этот проект лицензирован по лицензии MIT.